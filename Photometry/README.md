# FITS 文件

我们观测到的数据大部分都是FITS格式的，这种结构使得FITS文件可以携带详细的元信息和大量科学数据，方便数据的共享和处理。FITS文件主要分为两部分：

## Header
- 头部包含了数据的元信息，以ASCII文本格式记录。
- 每条信息以关键字-值对的形式存储，用于描述数据文件的结构、数据来源、观测条件等信息。
- 常见的头部关键字包括数据维度、曝光时间、观测仪器、数据单位等。
- 头部部分的内容为可扩展的，用户可以添加自定义的关键字以记录额外信息。

## Data
- 数据部分是实际存储的科学数据，可以是多维数组或表格。
- FITS支持多种数据类型，包括整数、浮点数等，能够适应不同观测数据的存储需求。
- 在天文学中，数据部分通常存储图像像素值、光谱数据等原始观测数据。


# 测光步骤简介
## 图像预处理
图像预处理是用于修正和校正由CCD/CMOS传感器本身的特性引起的各种问题，如噪声、偏差和传感器不均匀性等。通过一系列校正步骤，提高图像数据的质量，以便进行后续的精确测光分析。以下前5项，基本都可以用iraf的`iraf.noao.imred.ccdred.ccdproc`修正。pyraf批量修正详见()[]。
### 减本底
减本底（Bias Subtraction）是消除由传感器产生的本底信号。通过从原始图像中减去零曝光的偏置图像，可以消除由读取电子带来的基线偏置信号。
暗流修正
### 暗流修正
暗流修正（Dark Current Correction）用于补偿传感器在曝光时因温度导致的暗电流噪声。通过减去相同曝光时间的暗帧（Dark Frame），可以校正这种由热噪声引起的信号。
除平场
### 除平场
除平场（Flat Field Correction）用于消除图像中由传感器不均匀性或光学系统引起的像素增益差异。通过除以平场图像，能够均匀化视场内的亮度，确保测光的一致性。
### overscan修正
overscan修正用于修正图像读取过程中的电子噪声偏差。overscan区域是指在成像区之外的读出数据，通过该区域的数值校正图像整体偏移量。
修正坏点
### 修正坏点
修正坏点（Bad Pixel Correction）是用于处理因传感器缺陷而导致的坏点或死点。可以通过邻近像素的插值、平场图或坏点掩码来修正这些异常像素。
去除宇宙线
### 去除宇宙线
去除宇宙线（Cosmic Ray Removal）是消除由宇宙线撞击传感器产生的高能粒子噪声。常用方法包括多次曝光取中值法和图像滤波技术，以去除这种瞬时亮斑干扰。

## 加WCS
WCS是用于观测图像与天空中物理坐标（通常为赤经和赤纬）之间的映射系统。它定义了从图像坐标系（像素坐标）到天球坐标系（例如赤道坐标系或银河坐标系）的转换关系。WCS信息通常嵌入在FITS文件的Header部分，以一组标准化的关键字描述映射参数，如参考像素位置、坐标系统类型、坐标轴方向等。

### WCS在FITS文件Header中的形式
- **参考像素**（CRPIX）：指定图像中参考点（通常是中央像素）的像素坐标。
- **参考坐标**（CRVAL）：对应参考像素在物理坐标系（如赤经和赤纬）中的位置。
- **坐标类型**（CTYPE）：指示坐标系统类型，比如`RA---TAN`和`DEC--TAN`代表赤经和赤纬的切平面投影。
- **坐标系旋转**（CD或PC矩阵）：描述像素坐标系与物理坐标系之间的旋转和缩放关系。
- **每像素的坐标增量**（CDELT）：表示坐标增量，用于定义每个像素对应的物理尺度。

通过这些WCS参数，天文学家可以将图像中的天体位置转换成标准天球坐标，方便后续的科学分析和跨图像数据的比对。

较差测光（Differential Photometry）是一种相对测光方法，通过比较目标天体与参考星的亮度来测量其变化。这种方法可以减少由于大气条件变化、仪器不稳定性等因素对测光结果的影响，从而更准确地测量目标天体的相对亮度变化。

## 较差测光步骤

### 选参考星
选择参考星是较差测光中的关键步骤。参考星应具备以下特性：
- 亮度稳定：参考星在观测过程中应该没有明显的亮度变化。
- 接近目标天体：参考星应位于目标天体附近的视场内，以便受大气和仪器条件影响与目标天体相似。
- 相近亮度：理想情况下，参考星的亮度应与目标天体接近，以确保更精确的测光。

### 统计零点
统计零点是指通过比较参考星的已知星等与观测到的仪器星等，计算出观测夜晚的测光零点。零点的计算方式通常为参考星已知视星等与其观测到的仪器星等之差。在观测过程中，这一零点可以用于校正其他天体的仪器星等，减少大气透明度等因素的影响。

### 获得仪器星等
仪器星等（Instrumental Magnitude）是指在观测设备（如CCD相机）上的直接测量结果。通常是通过将参考星和目标天体的像素亮度值转换成星等值。这一结果未经过大气校正、仪器校正等处理，但在同一设备和同一夜晚的观测中可相对比较。

### 得到视星等
视星等（Apparent Magnitude）是校正后的星等值，通过将仪器星等加上统计得到的零点和其他校正因子，计算出目标天体的真实亮度。视星等反映了天体在观测时的真实亮度，方便进行不同时间和地点间的数据比对。

通过较差测光方法，可以获得目标天体在特定时间段内的亮度变化曲线，有助于研究如变星、超新星、食双星等天体的光变特性。

颜色改正（Color Correction）是在天文测光中用来校正由于观测条件或仪器响应差异而引起的颜色偏差的过程。观测时，天体在不同波段的亮度受大气消光、滤镜特性和仪器响应等因素影响，导致不同颜色（波段）的星等产生系统性偏差。颜色改正可以提高测光数据的准确性，使观测结果更接近天体的真实颜色和亮度。

## 为什么进行颜色改正

颜色改正的必要性源于以下几个原因：

1. **大气消光差异**：
   大气对光的吸收和散射作用随波长变化，对蓝光的吸收和散射更显著，对红光影响较小。因此，观测中不同波段的星等会受到不同程度的大气影响，导致颜色误差。

2. **仪器响应曲线差异**：
   不同的观测仪器（如CCD相机）在不同波段的敏感度不同，可能导致相同天体在不同波段的观测数据偏差。因此，在测量多个波段的亮度时，仪器响应的不一致会引入颜色偏差。

3. **滤镜特性**：
   使用滤镜观测时，不同波段的滤镜会引入不同程度的颜色偏差。例如，常用的UBVRI滤镜系统在不同波长范围内传输光的效率不同，需要颜色改正来校正滤镜之间的差异。

4. **天体本身的颜色指数**：
   不同天体具有不同的本色（即天体在不同波段的固有亮度差异），需要颜色改正来使观测值反映其真实颜色。这通常通过已知颜色指数（如B-V颜色指数）进行校正。

通过颜色改正，可以消除由观测条件和仪器特性引起的系统性误差，使最终的测光数据更准确，反映天体的真实亮度分布和颜色特性。这对于精确测量恒星的温度、化学成分和距离等特性具有重要作用。

# 基础软件
首先介绍几个常见的光学测光需要用到的基础软件
## iraf(必学软件)
[IRAF](https://iraf.net/)是天文学光学领域，数据处理和科学分析，最标准的，最科学，最全面的科学软件，是天文光学软件的旗舰和标杆。软件里面不仅仅包含了各种数据处理和科学分析的的功能，还拥有很全面使用指南。   

其各个平台（Mac/Linux）软件安装教程，详见[IRAF.docx](../Softwares/IRAF.docx)。Contributer: 郭方舟&马啸然

## DS9(必学软件)
[DS9](https://sites.google.com/cfa.harvard.edu/saoimageds9)查看图像和分析图像的强大的软件。

## Sextractor(值得学习)
[Sextractor](https://www.astromatic.net/software/sextractor/)是一个批量测光软件。

## WCS软件
莫军师兄的zrutyphot用的是Scamp，autophot用的Astromotry.net。看具体需求学习此类软件。
一般平常用坐标转化，的可以用`astropy.wcs`(https://docs.astropy.org/en/latest/wcs/index.html)模块来计算。
### Astromotry.net
[Astromotry.net](https://astrometry.net/)是一个强大的拟合WCS，但是需要预先下载catalog，占用空间较大，但是相对方便。
### Scamp
需要每次都下载对应天区的cataloge，不占用多余的储存空间，但是每次下载方便。

## 图像相减软件
### hotpants
### zogy
[ZOGY](http://ui.adsabs.harvard.edu/abs/2021ascl.soft05010V/abstract)

## 其他软件
### Swarp
### missfit


# 软件进阶
# IRAF测光
郑伟康老师的曾经写过IRAF的pipeline`zphot`。可能会涉及到郑伟康老师的版权问题，所以请在清华云盘[内部链接](https://cloud.tsinghua.edu.cn/smart-link/4dfcaebb-08bb-4889-83f8-0fab10fe9be9/)下载`zphot`的指南及代码。**zphot.pdf**包含了孔径测光、PSF测光、iraf测光基本操作等内容，是非常好的中文基础学习资料。（不包括预处理，预处理等知识，预处理请参照(LJT光谱和测光处理_超新星版.pdf)[]预处理部分。）

### Autophot

### zrutyphot
莫军硕士论文有介绍了TNT 80cm望远镜和一些数据处理方法。望远镜主要采用莫军搭建的zrutyphot，在登录组内服务器之后，终端输入  

```bash
phot
```
进入一个新的账户，然后参考zrutyphot用法，开始测光。莫军硕士论文以及zrutyphot用法，详见[内部链接](https://cloud.tsinghua.edu.cn/smart-link/4dfcaebb-08bb-4889-83f8-0fab10fe9be9/)   
黄芳师姐也有曾经对80厘米望远镜的数据介绍，[论文地址](https://iopscience.iop.org/article/10.1088/1674-4527/12/11/012/meta)。


# S-correction
## SVO+pyphot
[SVO](http://svo2.cab.inta-csic.es/) Filter Profile Service是一个包含了各种望远镜及其仪器滤光片的信息网站,我们可以通过这个数据，下载滤光片信息。另外，SVO可以通过python中astroquery直接获取信息，比直接从网站获取更方便快捷。[pyphot](https://mfouesneau.github.io/pyphot/)是一个强大的卷积滤光片透过率和光谱软件，两个工具配合好，可以玩转多波段测光数据。

## S-correction实例